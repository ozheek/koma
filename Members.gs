var SHEET_CONTACTS = "–ö–æ–Ω—Ç–∞–∫—Ç–∏"

/* –ú–ï–ù–Æ */
var MEMBERS_SHOW_LIST = '–ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫';
var MEMBERS_ADD = '–î–æ–¥–∞—Ç–∏';
var MEMBERS_EDIT = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏';

/* –°–ü–ò–°–ö–ò */
var MEMBERS = 'üë• –ß–ª–µ–Ω–∏ –∫–ª—É–±—É';
var MEMBERS_STATUSES = '–°—Ç–∞—Ç—É—Å–∏';
var MEMBERS_PROGRAM = '–ü—Ä–æ–≥—Ä–∞–º–∞';
var MEMBERS_POSITIONS = "–ü–æ—Å–∞–¥–∏";
var MEMBERS_PROGRAMS = "–ü—Ä–æ–≥—Ä–∞–º–∏";
var MEMBERS_CLUBS = "–ö–ª—É–±–∏";

var MEMBERS_PROGRAM_KOMA = '–ö–û–ú–ê';
var MEMBERS_PROGRAM_TOASTMASTERS = 'Toastmasters';

/* –°–¢–ê–¢–£–°–ò */
var MEMBERS_STATUS_GUEST = '–ì—ñ—Å—Ç—å';
var MEMBERS_STATUS_MEMBER = '–î—ñ–π—Å–Ω–∏–π —á–ª–µ–Ω';

/* –ó–ê–ì–û–õ–û–í–ö–ò –ë–ê–ó–ò –î–ê–ù–ù–ò–• */
var MEMBERS_HEADER_FULLNAME = "–Ü–º'—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ";
var MEMBERS_HEADER_MOBILE_PHONE_NUMBER = "–ú–æ–±—ñ–ª—å–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω";
var MEMBERS_HEADER_NAME = "–Ü–º'—è";
var MEMBERS_HEADER_LASTNAME = "–ü—Ä—ñ–∑–≤–∏—â–µ";
var MEMBERS_HEADER_CALLNAME = "–ö–ª–∏—á–Ω–∏–π –≤—ñ–¥–º—ñ–Ω–æ–∫";
var MEMBERS_HEADER_STATUS = "–°—Ç–∞—Ç—É—Å";
var MEMBERS_HEADER_EMAIL_ADDRESS = "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞";
var MEMBERS_HEADER_CLUB = "–ö–ª—É–±";
var MEMBERS_HEADER_POSITION = "–ü–æ—Å–∞–¥–∞";
var MEMBERS_HEADER_PROGRAM = '–ü—Ä–æ–≥—Ä–∞–º–∞';
var MEMBERS_HEADER_DATE = '–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó';
var MEMBERS_HEADER_MENTOR = '–ù–∞—Å—Ç–∞–≤–Ω–∏–∫';
var MEMBERS_HEADER_FACEBOOK = 'Facebook';
var MEMBERS_HEADER_TELEGRAM = '–¢–µ–ª–µ–≥—Ä–∞–º';

/*–ü–û–®–£–ö –ü–û –ë–ê–óI*/
var MEMBER_SEARCH_FAILED = '–ù–∞ –∂–∞–ª—å, —á–ª–µ–Ω–∞ –∫–ª—É–±—É –∑ —Ç–∞–∫–∏–º i–º–µ–Ω–µ–º –Ω–µ –±—É–ª–æ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑i...\
                        \n\n–ü–µ—Ä–µ–≤i—Ä—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞, —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏ –≤–≤–µ–ª–∏ i–º\'—è —ñ –ø—Äi–∑–≤–∏—â–µ —Ç–∞ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É!';
var SEVERAL_MEMBERS_FOUND = '–ó–∞ –≤–∞—à–∏–º –∑–∞–ø–∏—Ç–æ–º —è –∑–Ω–∞–π—à–æ–≤ –¥–µ–∫i–ª—å–∫–∞ —á–ª–µ–Ωi–≤ –∫–ª—É–±—É.\
                             \n\n–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Äi—Ç—å –∫–æ–≥–æ—Å—å i–∑ –Ω–∏—Ö –∞–±–æ –ø–æ–≤—Ç–æ—Äi—Ç—å –ø–æ—à—É–∫!';
var MEMBER_SEARCH_SUCCESS = '–Ø –∑–Ω–∞–π—à–æ–≤ —á–ª–µ–Ω–∞ –∫–ª—É–±—É –∑ i–º–µ–Ω–µ–º <b>{0}</b> —É —Å–≤–æ—ó–π –±–∞–∑i, i –º–∏ –º–æ–∂–µ–º–æ –ø—Ä–æ–¥–æ–≤–∂—É–≤–∞—Ç–∏ –¥–∞–ªi!'

/* –†–û–ë–û–ß–Ü –ó–ê–ì–û–õ–û–í–ö–ò */
var MEMBERS_HEADER_TELEGRAM_ID = "telegram_id";
var MEMBERS_HEADER_TELEGRAM_STATUS = "status";

/* –¢–ï–ö–°–¢–ò */
var MEMBERS_PREVIOUS_VALUE_EMPTY = '–ü–æ–ø–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—î';
var MEMBERS_PREVIOUS_VALUE = '–ü–æ–ø–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è {0} –±—É–¥–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–µ';

var MEMBERS_SELECT_NEW_MENTOR = '–í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–≤–æ–≥–æ –º–µ–Ω—Ç–æ—Ä–∞ –¥–ª—è {0}. {1}:';
var MEMBERS_SELECT_NEW_PROGRAM = '–í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–≤—É –ø—Ä–æ–≥—Ä–∞–º—É, –ø–æ —è–∫—ñ–π –±—É–¥–µ –∑–∞–π–º–∞—Ç–∏—Å—å {0}. {1}:';
var MEMBERS_SELECT_NEW_POSITION = '–í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–≤—É –æ—Ñ—ñ—Ü–µ—Ä—Å—å–∫—É –ø–æ–∑–∏—Ü—ñ—é –¥–ª—è {0}. {1}:';
var MEMBERS_SELECT_NEW_STATUS = '–í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å –¥–ª—è {0}. {1}:';
var MEMBERS_SELECT_NEW_CLUB = '–í–∏–±–µ—Ä—ñ—Ç—å –∑ —è–∫–æ–≥–æ –∫–ª—É–±—É {0}. {1}:';
var MEMBERS_SELECT_NEW_EMAIL_ADDRESS = '–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –ø–æ—à—Ç—É –¥–ª—è {0}. {1}:';
var MEMBERS_SELECT_NEW_CALLNAME = '–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–∏–π –∫–ª–∏—á–Ω–∏–π –≤—ñ–¥–º—ñ–Ω–æ–∫ –¥–ª—è {0}. {1}:';
var MEMBERS_SELECT_NEW_MOBILE_PHONE_NUMBER = '–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–∏–π –Ω–æ–º–µ—Ä –º–æ–±—ñ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É —É —Ñ–æ—Ä–º–∞—Ç—ñ +380—Ö—Ö—Ö—Ö—Ö—Ö—Ö—Ö—Ö. {1}:';
var MEMBERS_SELECT_NEW_FACEBOOK = '–í–≤–µ–¥—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –§–µ–π—Å–±—É–∫-—Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è {0}. {1}:';
var MEMBERS_SELECT_NEW_NAME = '–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–µ —ñ–º\'—è –¥–ª—è {0} (–ø–æ–≤–Ω–µ —ñ–º\'—è –±—É–¥–µ –∑–º—ñ–Ω–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ). {1}:';
var MEMBERS_SELECT_NEW_LASTNAME = '–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–µ –ø—Ä—ñ–∑–≤–∏—â–µ –¥–ª—è {0} (–ø–æ–≤–Ω–µ —ñ–º\'—è –±—É–¥–µ –∑–º—ñ–Ω–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ). {1}:';
var MEMBERS_SUCCESS_ADDED = '–î—è–∫—É—é! –î–æ–¥–∞–≤ <b>{0} {1}</b> (<i>{2}</i>) –¥–æ –±–∞–∑–∏.\n‚òéÔ∏è: {3}, üìß: {4}\n\n<b>–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —ñ–Ω—à–∏—Ö –ø–æ–ª–µ–π.</b>';

var MEMBERS_CANCEL_ROLE = '{0}, –ø—Ä–∏–≤—ñ—Ç! üòä –ù–∞ –∂–∞–ª—å, –≤–∞—à—É —Ä–æ–ª—å <b>{1}</b> –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ <b>{2}</b> –±—É–ª–æ —Å–∫–∞—Å–æ–≤–∞–Ω–æ üòå. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –≤—ñ—Ü–µ-–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ –∑ –æ—Å–≤—ñ—Ç–∏, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—å –¥–µ—Ç–∞–ª—ñ –∞–±–æ –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ø—Ä–æ–≥—Ä–∞–º—É –∑–∞—Å—ñ–¥–∞–Ω–Ω—è.\n\n–ú–æ–∂–ª–∏–≤–æ —Ü—å–æ–≥–æ –¥–Ω—è –≤ –∫–ª—É–±—ñ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è –∫–æ–Ω–∫—É—Ä—Å –∞–±–æ —ñ–Ω—à–∏–π –∑–∞—Ö—ñ–¥ üòç';

var MEMBERS_TYPE_NEW_VALUE = '–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—ñ –¥–∞–Ω—ñ –ø–æ–ª—è {0} –¥–ª—è {1}. {1}:';
var MEMBERS_CHOOSE_STATUS = '–í–∏–±–µ—Ä—ñ—Ç—å —Å—Ç–∞—Ç—É—Å:';
var MEMBERS_CHOOSE_EMAIL_ADDRESS = '–í–≤–µ–¥—ñ—Ç—å –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –ø–æ—à—Ç—É:';
var MEMBERS_CHOOSE_PHONE_NUMBER = '–í–≤–µ–¥—ñ—Ç—å –º–æ–±—ñ–ª—å–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω (—Ñ–æ—Ä–º–∞—Ç: +380—Ö—Ö—Ö—Ö—Ö—Ö—Ö—Ö—Ö):';
var MEMBERS_CHOOSE_CALLNAME = '–í–≤–µ–¥—ñ—Ç—å –∫–ª–∏—á–Ω–∏–π –≤—ñ–¥–º—ñ–Ω–æ–∫ —ñ–º–µ–Ω—ñ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø—ñ–¥–∫–∞–∑–∫—É –≤ –º–µ–Ω—é):';
var MEMBERS_CHOOSE_LASTNAME = '–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ:';
var MEMBERS_CHOOSE_MEMBER = '–í–∏–±–µ—Ä—ñ—Ç—å —á–ª–µ–Ω—É –∫–ª—É–±—É, —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –π–æ–≥–æ —Ö–æ—á–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏:';
var MEMBERS_CHOOSE_NAME = '–í–≤–µ–¥—ñ—Ç—å —ñ–º\'—è (–±–µ–∑ –ø—Ä—ñ–∑–≤–∏—â–∞):';
var MEMBERS_CHOOSE_FIELD = '–í–∏–±–µ—Ä—ñ—Ç—å –ø–æ–ª–µ, —â–æ —Ö–æ—á–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏:';
var MEMBERS_SUCCESS_UPDATE = '–î—è–∫—É—é! –ó–º—ñ–Ω–∏–≤ {0} –Ω–∞ {1} –¥–ª—è {2} üòç\n\n<b>–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —ñ–Ω—à–∏—Ö –ø–æ–ª–µ–π.</b>';
var MEMBERS_MEMBER_ALREADY_EXISTS = '–ù–∞ –∂–∞–ª—å, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á <b>{0}</b> –≤–∂–µ <b>—î –≤ –±–∞–∑—ñ</b> üòü. –Ø–∫—â–æ —Ü–µ –Ω–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, —Å–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —ñ–º–µ–Ω—ñ.';

var MEMBERS_LIST = '<b>–°–ø–∏—Å–æ–∫ —á–ª–µ–Ω—ñ–≤ –∫–ª—É–±—É —Ç–∞ –≥–æ—Å—Ç–µ–π ({0}):</b>\n\n';
var MEMBERS_LIST_EMPTY = '–ó–∞ –≤–∏–±—Ä–∞–Ω–∏–º –∫—Ä–∏—Ç–µ—Ä—ñ—î–º –Ω–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ üòî';

var MEMBERS_LIST_PHONE_NUMBER = '\n–¢–µ–ª–µ—Ñ–æ–Ω: +{0}';
var MEMBERS_LIST_EMAIL = '\n–ü–æ—à—Ç–∞: {0}';
var MEMBERS_LIST_TELEGRAM = '\n–¢–µ–ª–µ–≥—Ä–∞–º: @{0}';
var MEMBERS_LIST_CLUB = '\n–ö–ª—É–±: {0}';
var MEMBERS_LIST_POSITION = '\n–û—Ñ—ñ—Ü–µ—Ä: {0}';
var MEMBERS_LIST_PROGRAM = '\n–ü—Ä–æ–≥—Ä–∞–º–∞: {0}';
var MEMBERS_LIST_MENTOR = '\n–ú–µ–Ω—Ç–æ—Ä: {0}';
var MEMBERS_LIST_FACEBOOK = '\n–§–µ–π—Å–±—É–∫: {0}';
var MEMBERS_LIST_DATE = '\n–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: {0}';

var MEMBERS_LIST_ALL = '–í—Å—ñ';
var MEMBERS_LIST_CHOOSE_STATUS = '–í–∏–±–µ—Ä—ñ—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏:';

function processMembers(userData, text) {
    if (userData.statuses[2]) {
        if (userData.statuses[2] == MEMBERS_EDIT) {
            if (userData.statuses[3]) {
                if (userData.statuses[4]) {
                    if (!userData.statuses[5]) {
                        if (userData.statuses[4] == MEMBERS_HEADER_MOBILE_PHONE_NUMBER) {
                            text = text.replace('+', '');
                        } else if (userData.statuses[4] == MEMBERS_HEADER_NAME || userData.statuses[4] == MEMBERS_HEADER_LASTNAME) {
                            var memberInfo = getMemberInfo(MEMBERS_HEADER_FULLNAME, userData.statuses[3]);
                            var fullName = userData.statuses[4] == MEMBERS_HEADER_NAME ?
                                text + ' ' + memberInfo.fields[MEMBERS_HEADER_LASTNAME] :
                                memberInfo.fields[MEMBERS_HEADER_NAME] + ' ' + text;

                            updateMemberInfo(MEMBERS_HEADER_FULLNAME, userData.statuses[3], MEMBERS_HEADER_FULLNAME, fullName);
                        }
                        updateMemberInfo(MEMBERS_HEADER_FULLNAME, userData.statuses[3], userData.statuses[4], text);
                        showMenu(userData.telegramId, format(MEMBERS_SUCCESS_UPDATE, userData.statuses[4], text, userData.statuses[3]));
                        continueEditMember(userData, userData.statuses[3]);
                        return false;
                    }
                } else {
                    var memberInfo = getMemberInfo(MEMBERS_HEADER_FULLNAME, userData.statuses[3]);
                    var previousValue = memberInfo.fields[text] ? format(MEMBERS_PREVIOUS_VALUE, memberInfo.fields[text]) : MEMBERS_PREVIOUS_VALUE_EMPTY;

                    if (text == MEMBERS_HEADER_STATUS) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_STATUS, userData.statuses[3], previousValue), getListItemsByName(MEMBERS_STATUSES));
                    } else if (text == MEMBERS_HEADER_POSITION) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_POSITION, userData.statuses[3], previousValue), getListItemsByName(MEMBERS_POSITIONS));
                    } else if (text == MEMBERS_HEADER_PROGRAM) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_PROGRAM, userData.statuses[3], previousValue), getListItemsByName(MEMBERS_PROGRAMS));
                    } else if (text == MEMBERS_HEADER_MENTOR) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_MENTOR, userData.statuses[3], previousValue), getAllMembers());
                    } else if (text == MEMBERS_HEADER_CLUB) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_CLUB, userData.statuses[3], previousValue), getListItemsByName(MEMBERS_CLUBS));
                    } else if (text == MEMBERS_HEADER_EMAIL_ADDRESS) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_EMAIL_ADDRESS, userData.statuses[3], previousValue));
                    } else if (text == MEMBERS_HEADER_CALLNAME) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_CALLNAME, userData.statuses[3], previousValue));
                    } else if (text == MEMBERS_HEADER_NAME) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_NAME, userData.statuses[3], previousValue));
                    } else if (text == MEMBERS_HEADER_LASTNAME) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_LASTNAME, userData.statuses[3], previousValue));
                    } else if (text == MEMBERS_HEADER_FACEBOOK) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_FACEBOOK, userData.statuses[3], previousValue));
                    } else if (text == MEMBERS_HEADER_MOBILE_PHONE_NUMBER) {
                        showMenu(userData.telegramId, format(MEMBERS_SELECT_NEW_MOBILE_PHONE_NUMBER, userData.statuses[3], previousValue));
                    } else {
                        showMenu(userData.telegramId, format(MEMBERS_TYPE_NEW_VALUE, text, userData.statuses[3], previousValue));
                    }
                    return true;
                }
            } else {
                var memberInfo = getMemberInfo(MEMBERS_HEADER_FULLNAME, text);

                var items = getMemberFields();
                var index = items.indexOf(MEMBERS_HEADER_DATE);
                items.splice(index, 1);

                showMenu(userData.telegramId, MEMBERS_CHOOSE_FIELD, items);
                return true;
            }
        } else if (userData.statuses[2] == MEMBERS_ADD) {
            if (userData.statuses[3]) {
                if (userData.statuses[4]) {
                    if (userData.statuses[5]) {
                        if (userData.statuses[6]) {
                            if (userData.statuses[7]) {
                                if (!userData.statuses[8]) {
                                    var name = userData.statuses[4];
                                    var lastname = userData.statuses[3];
                                    var fullName = name + ' ' + lastname;
                                    var callName = userData.statuses[5];
                                    var phoneNumber = userData.statuses[6].replace('+', '') == EMPTY ? '' : userData.statuses[6];
                                    var email = userData.statuses[7] == EMPTY ? '' : userData.statuses[7];
                                    var status = text;

                                    insertMembersData(name, lastname, callName, phoneNumber, email, status);

                                    showMenu(userData.telegramId, format(MEMBERS_SUCCESS_ADDED, name, lastname, status, userData.statuses[6], userData.statuses[7]));
                                    continueEditMember(userData, fullName);

                                    return false;
                                }
                            } else {
                                showMenu(userData.telegramId, MEMBERS_CHOOSE_STATUS, getListItemsByName(MEMBERS_STATUSES));
                                return true;
                            }
                        } else {
                            showMenu(userData.telegramId, MEMBERS_CHOOSE_EMAIL_ADDRESS, [EMPTY]);
                            return true;
                        }
                    } else {
                        showMenu(userData.telegramId, MEMBERS_CHOOSE_PHONE_NUMBER, [EMPTY]);
                        return true;
                    }
                } else {
                    var fullName = capitalizeFirstLetter(text) + ' ' + capitalizeFirstLetter(userData.statuses[3]);//
                    var memberInfo = getMemberInfo(MEMBERS_HEADER_FULLNAME, fullName);
                    if (memberInfo) {
                        showMenu(userData.telegramId, format(MEMBERS_MEMBER_ALREADY_EXISTS, fullName));
                        goBack(userData);
                        return false;
                    } else {
                        showMenu(userData.telegramId, MEMBERS_CHOOSE_CALLNAME, [getCallName(capitalizeFirstLetter(text))]);
                        return true;
                    }
                }
            } else {
                showMenu(userData.telegramId, MEMBERS_CHOOSE_NAME);
                return true;
            }
        } else if (userData.statuses[2] == MEMBERS_SHOW_LIST) {
            if (!userData.statuses[3]) {
                showMembers(userData.telegramId, text);
                return true;
            }
        }
    } else {
        if (text == MEMBERS_EDIT) {
            showMenu(userData.telegramId, MEMBERS_CHOOSE_MEMBER, getAllMembers());
            return true;
        } else if (text == MEMBERS_ADD) {
            showMenu(userData.telegramId, MEMBERS_CHOOSE_LASTNAME);
            return true;
        } else if (text == MEMBERS_SHOW_LIST) {
            var items = getListItemsByName(MEMBERS_STATUSES);
            items.unshift(MEMBERS_LIST_ALL);
            showMenu(userData.telegramId, MEMBERS_LIST_CHOOSE_STATUS, items);
            return true;
        }
    }
}

function showMembers(userTelegramId, status) {
    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_CONTACTS);

    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];

    var fullNameHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_FULLNAME);
    var mobilePhoneNumberHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_MOBILE_PHONE_NUMBER);
    var emailAddressHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_EMAIL_ADDRESS);
    var statusHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_STATUS);
    var clubHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_CLUB);
    var positionHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_POSITION);
    var programHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_PROGRAM);
    var mentorHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_MENTOR);
    var facebookHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_FACEBOOK);
    var dateHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_DATE);
    var telegramHeaderIndex = headerValues.findIndex(MEMBERS_HEADER_TELEGRAM);

    var values = sheet.getRange(2, 1, sheet.getLastRow(), sheet.getLastColumn()).getValues();

    var message = format(MEMBERS_LIST, status);
    var number = 1;

    for (var i = 0; i < values.length; i++) {
        var row = values[i];

        if (row && row[fullNameHeaderIndex] && (status == MEMBERS_LIST_ALL || status == row[statusHeaderIndex])) {
            message += number + '. <b>' + row[fullNameHeaderIndex] + '</b> (<i>' + row[statusHeaderIndex] + '</i>)';

            if (row[mobilePhoneNumberHeaderIndex])
                message += format(MEMBERS_LIST_PHONE_NUMBER, row[mobilePhoneNumberHeaderIndex]);
            if (row[emailAddressHeaderIndex])
                message += format(MEMBERS_LIST_EMAIL, row[emailAddressHeaderIndex]);
            if (row[telegramHeaderIndex])
                message += format(MEMBERS_LIST_TELEGRAM, row[telegramHeaderIndex]);
            if (row[mentorHeaderIndex])
                message += format(MEMBERS_LIST_MENTOR, row[mentorHeaderIndex]);
            if (row[clubHeaderIndex])
                message += format(MEMBERS_LIST_CLUB, row[clubHeaderIndex]);
            if (row[positionHeaderIndex])
                message += format(MEMBERS_LIST_POSITION, row[positionHeaderIndex]);
            if (row[programHeaderIndex])
                message += format(MEMBERS_LIST_PROGRAM, row[programHeaderIndex]);
            if (row[facebookHeaderIndex])
                message += format(MEMBERS_LIST_FACEBOOK, row[facebookHeaderIndex]);
            if (row[dateHeaderIndex])
                message += format(MEMBERS_LIST_DATE, formatDate(row[dateHeaderIndex]));

            message += '\n\n';
            number++;
        }

        if (message.length >= 4048) {
            if (message) {
                showMenu(userTelegramId, message);
                message = '';
            }
        }
    }

    if (number == 1) {
        message += MEMBERS_LIST_EMPTY;
    }

    if (message) {
        showMenu(userTelegramId, message);
        message = '';
    }
}

function sendMemberCanceledRoleMessage(memberInfo, date, role)
{
    if (memberInfo && memberInfo.telegramId) {
      sendText(memberInfo.telegramId, format(MEMBERS_CANCEL_ROLE, memberInfo.fields[MEMBERS_HEADER_CALLNAME], role, date));              
    }       
}

/* –†–û–ë–û–¢–ê –ó –ë–ê–ó–û–Æ */

function insertMembersData(name, lastname, callName, phoneNumber, email, status, club, telegramId, username, telegramStatus) {
    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_CONTACTS);
    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];

    var fullNameColumnIndex = headerValues.findIndex(MEMBERS_HEADER_FULLNAME);
    
    var telegramIdColumnIndex = headerValues.findIndex(MEMBERS_HEADER_TELEGRAM_ID);
    var telegramStatusColumnIndex = headerValues.findIndex(MEMBERS_HEADER_TELEGRAM_STATUS);
    var telegramColumnIndex = headerValues.findIndex(MEMBERS_HEADER_TELEGRAM);
   
    var nameColumnIndex = headerValues.findIndex(MEMBERS_HEADER_NAME);
    var lastnameColumnIndex = headerValues.findIndex(MEMBERS_HEADER_LASTNAME);
    var callNameColumnIndex = headerValues.findIndex(MEMBERS_HEADER_CALLNAME);
    var phoneNumberColumnIndex = headerValues.findIndex(MEMBERS_HEADER_MOBILE_PHONE_NUMBER);
    var statusColumnIndex = headerValues.findIndex(MEMBERS_HEADER_STATUS);
    var emailAddressColumnIndex = headerValues.findIndex(MEMBERS_HEADER_EMAIL_ADDRESS);
    var clubColumnIndex = headerValues.findIndex(MEMBERS_HEADER_CLUB);
    var dateColumnIndex = headerValues.findIndex(MEMBERS_HEADER_DATE);

    var lastRowIndex = sheet.getLastRow();
    var lastColumnIndex = sheet.getLastColumn();

    sheet.insertRowsAfter(lastRowIndex, 1);
    var insertedRange = sheet.getRange(lastRowIndex + 1, 1, 1, lastColumnIndex);

    var values = [
        []
    ];
    for (var i = 0; i < lastColumnIndex; i++) {
        values[0].push('');
    }
  
    name = capitalizeFirstLetter(name);
    lastname = capitalizeFirstLetter(lastname);
    callName = capitalizeFirstLetter(callName);

    values[0][fullNameColumnIndex] = (name + ' ' + lastname).trim();
    values[0][nameColumnIndex] = name;
    values[0][lastnameColumnIndex] = lastname;
    values[0][callNameColumnIndex] = callName;
    values[0][phoneNumberColumnIndex] = phoneNumber.replace('+', '');;
    values[0][emailAddressColumnIndex] = email;
    values[0][statusColumnIndex] = status;
    values[0][telegramStatusColumnIndex] = telegramStatus;
    values[0][telegramIdColumnIndex] = (telegramId ? telegramId : '');  
    values[0][telegramColumnIndex] = (username ? username : '');
    values[0][dateColumnIndex] = formatDate(new Date());

    insertedRange.setValues(values);
}

function getMemberFields() {
    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_CONTACTS);
    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];

    var fullNameColumnIndex = headerValues.findIndex(MEMBERS_HEADER_FULLNAME);
    var telegramIdColumnIndex = headerValues.findIndex(MEMBERS_HEADER_TELEGRAM_ID);

    var fields = [];

    for (var i = fullNameColumnIndex + 1; i < telegramIdColumnIndex; i++) {
        fields.push(headerValues[i]);
    }

    return fields;
}

function getAllMembers(searchHeader, searchValue) {
    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_CONTACTS);
    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];

    //var fullNameColumnIndex = headerValues.findIndex(MEMBERS_HEADER_FULLNAME); 
    var lastNameColumnIndex = headerValues.findIndex(MEMBERS_HEADER_LASTNAME);
    var firstNameColumnIndex = headerValues.findIndex(MEMBERS_HEADER_NAME);
    var searchColumnIndex = headerValues.findIndex(searchHeader);
    
    var members = {};

    var range = sheet.getRange(2, 1, sheet.getLastRow() - 1, sheet.getLastColumn());
    var values = range.getValues();

    for (var i = 0; i < values.length; i++) {
        if (!searchHeader || searchHeader && (!searchValue && values[i][searchColumnIndex] || values[i][searchColumnIndex] == searchValue)) {
            //var fullName = values[i][fullNameColumnIndex];
            // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –ø—Ä—ñ–∑–≤–∏—â–µ–º
            var lastName = values[i][lastNameColumnIndex];
            var firstName = values[i][firstNameColumnIndex];
            if (!lastName || !firstName) continue;
            //var fullName = lastName + ' ' + firstName;
            var fullName = firstName + ' ' + lastName;
            members[fullName] = fullName;
            // —â–æ–± —Å–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞ —ñ–º'—è–º: members[fullName] = fullName;
        } 
    }

    const sortedMembers = [];
    Object.keys(members).sort().forEach(function(key) {
        sortedMembers.push(members[key]);
    });
    
    return sortedMembers;
}

function getMemberInfo(searchHeader, searchValue) {
    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_CONTACTS);
    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];

    var searchColumnIndex = headerValues.findIndex(searchHeader);

    var telegramIdColumnIndex = headerValues.findIndex(MEMBERS_HEADER_TELEGRAM_ID);
    var statusColumnIndex = headerValues.findIndex(MEMBERS_HEADER_TELEGRAM_STATUS);
    var fullNameColumnIndex = headerValues.findIndex(MEMBERS_HEADER_FULLNAME);

    var values = sheet.getRange(2, searchColumnIndex + 1, sheet.getLastRow(), 1).getValues();
    var userRowIndex = values.findIndex(searchValue) + 1 /* +1 to skip header */ ;

    if (userRowIndex == 0) {
        return null;
    }

    var userDataValues = sheet.getRange(userRowIndex + 1, 1, 1, sheet.getLastColumn()).getValues()[0];

    var fields = {};
    for (var i = 0; i < userDataValues.length; i++) {
        fields[headerValues[i]] = userDataValues[i];
    }

    var status = userDataValues[statusColumnIndex];
    var telegramId = userDataValues[telegramIdColumnIndex];
    var fullName = userDataValues[fullNameColumnIndex];

    return {
        telegramId: telegramId,
        fullName: fullName,
        callName: fields[MEMBERS_HEADER_CALLNAME],
        name : fields[MEMBERS_HEADER_NAME],
        fields: fields,
        status: status,
        statuses: status.split('___')
    };
}

function updateMemberInfo(searchHeader, searchValue, setHeader, setValue) {
    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_CONTACTS);
    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];

    var searchColumnIndex = headerValues.findIndex(searchHeader);
    var setColumnIndex = headerValues.findIndex(setHeader);

    var searchValues = sheet.getRange(2, searchColumnIndex + 1, sheet.getLastRow(), 1).getValues();
    var userRowIndex = searchValues.findIndex(searchValue) + 1 /* +1 to skip header */ ;

    if (userRowIndex == 0) {
        return null;
    }

    sheet.getRange(userRowIndex + 1, setColumnIndex + 1).setValue(setValue);
}

function continueEditMember(userData, fullName) {
    userData.statuses = userData.statuses.slice(0, 2);
    userData.statuses.push(MEMBERS_EDIT);
    userData.status = userData.statuses.join('___') + '___';
    processRequest(userData, fullName);
}

/* –¢–ï–õ–ï–ì–†–ê–ú –°–¢–ê–¢–£–° */

function resetStatus(userTelegramId) {
    updateMemberInfo(MEMBERS_HEADER_TELEGRAM_ID, userTelegramId, MEMBERS_HEADER_TELEGRAM_STATUS, '');
}