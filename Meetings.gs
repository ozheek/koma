var SHEET_MEETINGS = '–ó–∞—Å—ñ–¥–∞–Ω–Ω—è';

/* –û–ü–¶–Ü–á */

var LIBRARY_BOOK_FEE = 10; // 10–≥—Ä–Ω

/* –°–ü–ò–°–ö–ò */

var MEETING_PROJECTS = '–ü—Ä–æ–µ–∫—Ç–∏';

/* –ú–ï–ù–Æ */

var MEETING = "üé§Ô∏è –ó–∞—Å—ñ–¥–∞–Ω–Ω—è";

var MEETING_SHOW_MY_ROLES = "–ü–æ–∫–∞–∑–∞—Ç–∏ –º–æ—ó —Ä–æ–ª—ñ";
var MEETING_SHOW_PROGRAM = "–ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è";
var MEETING_SIGN_UP_FOR_ROLE = "–ó–∞–ø–∏—Å–∞—Ç–∏—Å—å –Ω–∞ —Ä–æ–ª—å";

var MEETING_ASSIGN_ROLE = "–ó–∞–ø–∏—Å–∞—Ç–∏ –Ω–∞ —Ä–æ–ª—å";
var MEETING_SHOW_ROLES = "–ü–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞ —è–∫—ñ —Ä–æ–ª—ñ –∑–∞–ø–∏—Å–∞–Ω–∏–π —á–ª–µ–Ω –∫–ª—É–±—É";

var MEETING_SIGN_UP_DATE = "–í–∏–±—Ä–∞—Ç–∏ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è (–¥–∞—Ç—É)";
var MEETING_SIGN_UP_ROLE = "–í–∏–±—Ä–∞—Ç–∏ —Ä–æ–ª—å";

var MEETING_ROLE_REJECT = '‚ùó –ó–≤—ñ–ª—å–Ω–∏—Ç–∏';
var MEETING_ROLE_CHANGE = '‚ùó –ó–º—ñ–Ω–∏—Ç–∏';
var MEETING_ROLE_CLEAN = '–ù—ñ—Ö—Ç–æ';
var MEETING_ROLE_NOBODY = '–ù—ñ—Ö—Ç–æ –Ω–µ –≤–∏–∫–æ–Ω—É–≤–∞–≤';
var MEETING_ROLE_REJECT_CALLBACK = 'unsign_role';
var MEETING_ROLE_CHANGE_CALLBACK = 'change_role';
var MEETING_ROLE_CLEAN_CALLBACK = 'clean_role';
var MEETING_SPEACH_CHANGE_PROJECT_CALLBACK = 'change_speach_project';
var MEETING_SPEACH_CHANGE_TITLE_CALLBACK = 'change_speach_title';

var MEETING_SPEACH_CHANGE_PROJECT = '‚úèÔ∏è –í–∫–∞–∑–∞—Ç–∏ –ø—Ä–æ–µ–∫—Ç –ø—Ä–æ–º–æ–≤–∏';
var MEETING_SPEACH_CHANGE_TITLE = '‚úèÔ∏è –í–∫–∞–∑–∞—Ç–∏ –Ω–∞–∑–≤—É –ø—Ä–æ–º–æ–≤–∏';

/* –û–°–ù–û–í–ù–Ü –†–û–õ–Ü */

var MEETING_SPEACH = "–ü—Ä–æ–º–æ–≤–∞";
var MEETING_EVALUATION = "–í—ñ–¥–≥—É–∫ –Ω–∞ –ø—Ä–æ–º–æ–≤—É";
var MEETING_SPEACH_PROJECT = "–ü—Ä–æ–µ–∫—Ç –ø—Ä–æ–º–æ–≤–∏";
var MEETING_SPEACH_TITLE = "–ù–∞–∑–≤–∞ –ø—Ä–æ–º–æ–≤–∏";
var MEETING_ROLE_TOASTMASTER = "–ì–æ–ª–æ–≤–∞";
var MEETING_WORD_OF_THE_DAY = "–°–ª–æ–≤–æ –¥–Ω—è";
var MEETING_TOPIC_NAME = "–¢–µ–º–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è";

/* –¢–ï–ö–°–¢–ò */

var MEETING_NOTIFICATION_TITLE = '–ü—Ä–∏–≤—ñ—Ç, {2}! ‚ò∫Ô∏è –ù–∞–≥–∞–¥—É—é, —â–æ –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ <b>{0}</b> –≤–∏ –±—É–¥–µ—Ç–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ä–æ–ª—å <b>{1}</b> üòç.';

var MEETING_SPEACH_NO_PROJECT = 'üì£ –î–ª—è –≤–∞—à–æ—ó –ø—Ä–æ–º–æ–≤–∏ –≤ –º–µ–Ω–µ –ø–æ–∫–∏ –Ω–µ–º–∞—î –Ω–∞–∑–≤–∏ –ø—Ä–æ–µ–∫—Ç—É. –ü–æ–≤—ñ–¥–æ–º—Ç–µ —è–∫–æ–º–æ–≥–∞ —Ä–∞–Ω—ñ—à–µ –º–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç –ø—Ä–æ–º–æ–≤–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ üëáüèª';
var MEETING_SPEACH_NO_TITLE = 'üì£ –©–æ–± —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É, –º–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –Ω–∞–∑–≤–∞ –≤–∞—à–æ—ó –ø—Ä–æ–º–æ–≤–∏. –ß–∏ –∑–Ω–∞—î—Ç–µ –≤–∏ –≤–∂–µ –Ω–∞–∑–≤—É –ø—Ä–æ–º–æ–≤–∏? –Ø–∫—â–æ —Ç–∞–∫, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —ó—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ üëáüèª';

var MEETING_SPEACH_PROJECT_EMPTY = '–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç—É';

var MEETING_SPEACH_CHOOSE_PROJECT = '–í–∫–∞–∂—ñ—Ç—å –ø—Ä–æ–µ–∫—Ç –≤–∞—à–æ—ó –ø—Ä–æ–º–æ–≤–∏:';
var MEETING_SPEACH_CHOOSE_TITLE = '–í–∫–∞–∂—ñ—Ç—å –Ω–∞–∑–≤—É –≤–∞—à–æ—ó –ø—Ä–æ–º–æ–≤–∏:';

var MEETING_PROGRAM_CHOOSE_DATE = '–í–∏–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É –∑–∞—Å—ñ–¥–∞–Ω–Ω—è:';
var MEETING_PROGRAM_TITLE = '<b>–ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è {0}</b>\n\n';
var MEETING_PROGRAM_ROLE_INFO = '<b>{0}</b>: {1}\n';
var MEETING_PROGRAM_ROLE_SPEACH_INFO = '<b>{0}</b> <i>({1})</i>: {2}\n';

var MEETING_SIGN_UP_SUCCESS = '–í—ñ—Ç–∞—é! –í–∏ –±—É–¥–µ—Ç–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ä–æ–ª—å <b>{0}</b> –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ <b>{1}</b>! üòç';
var MEETING_SIGN_UP_ROLES_BUSY = '–ù–∞ –∂–∞–ª—å, —Ä–æ–ª—å {0} –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ {1} –≤–∂–µ –∑–∞–π–Ω—è—Ç–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à—É —Ä–æ–ª—å.';
var MEETING_SIGN_UP_ROLES_AVAILABLE = '–î–æ—Å—Ç—É–ø–Ω—ñ —Ä–æ–ª—ñ –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è {0}:';

var MEETING_SIGN_UP_DATE_BUSY = '–ù–∞ –∂–∞–ª—å, —Ä–æ–ª—å {0} –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ {1} –≤–∂–µ –∑–∞–π–Ω—è—Ç–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à—É –¥–∞—Ç—É.';

var MEETING_SIGN_UP_DATE_AVAILABLE = '–î–æ—Å—Ç—É–ø–Ω—ñ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–ª—ñ {0}:';
var MEETING_SIGN_UP_ROLE_REQUEST = '–Ø–∫—É —Ä–æ–ª—å –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏?';
var MEETING_SIGN_UP_DATE_REQUEST = '–ù–∞ —è–∫–µ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∑—è—Ç–∏ —Ä–æ–ª—å?';
var MEETING_SIGN_UP_SELECT_ROLE_OR_DATE = '–•–æ—á–µ—Ç–µ –≤–∏–±—Ä–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É –∑–∞—Å—ñ–¥–∞–Ω–Ω—è —á–∏ —Ä–æ–ª—å?';

var MEETING_ASSIGN_ROLE_SUCCESS = '–í—ñ—Ç–∞—é! {0} –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ä–æ–ª—å {1} –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ {2}! üòç';
var MEETING_ASSIGN_ROLE_BUSY_ROLE = '–ù–∞ –∂–∞–ª—å, —Ä–æ–ª—å {0} –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ {1} –≤–∂–µ –∑–∞–π–Ω—è—Ç–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à—É —Ä–æ–ª—å:';
var MEETING_ASSIGN_ROLE_BUSY_DATE = '–ù–∞ –∂–∞–ª—å, —Ä–æ–ª—å {0} –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ {1} –≤–∂–µ –∑–∞–π–Ω—è—Ç–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à—É –¥–∞—Ç—É:';
var MEETING_ASSIGN_ROLE_AVAILABLE_ROLES = '–î–æ—Å—Ç—É–ø–Ω—ñ —Ä–æ–ª—ñ –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è {0}:';
var MEETING_ASSIGN_ROLE_AVAILABLE_DATES = '–î–æ—Å—Ç—É–ø–Ω—ñ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–ª—ñ {0}:';
var MEETING_ASSIGN_ROLE_SELECT_MEMBER = '–û–±–µ—Ä—ñ—Ç—å —á–ª–µ–Ω–∞ –∫–ª—É–±—É, —è–∫–æ–≥–æ —Ö–æ—á–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç–∏ –Ω–∞ —Ä–æ–ª—å?';
var MEETING_ASSIGN_ROLE_SELECT_DATE = '–ù–∞ —è–∫–µ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –∑–∞–ø–∏—Å–∞—Ç–∏?';
var MEETING_ASSIGN_ROLE_SELECT_ROLE = '–Ø–∫—É —Ä–æ–ª—å –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏?';
var MEETING_ASSIGN_ROLE_SELECT_ROLE_OR_DATE = '–•–æ—á–µ—Ç–µ –≤–∏–±—Ä–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É –∑–∞—Å—ñ–¥–∞–Ω–Ω—è —á–∏ —Ä–æ–ª—å?';


var MEETING_ROLES_NOT_ASSIGNED = '–í–∏ –Ω–µ –∑–∞–ø–∏—Å–∞–Ω—ñ –Ω–∞ –∂–æ–¥–Ω—É —Ä–æ–ª—å.';
var MEETING_ROLES_MEMBER_NOT_ASSIGNESD = '{0} –Ω–µ –∑–∞–ø–∏—Å–∞–Ω–∏–π –Ω–∞ –∂–æ–¥–Ω—É —Ä–æ–ª—å.';
var MEETING_ROLES_ASSIGNED_TITLE = '<b>–í–∏ –∑–∞–ø–∏—Å–∞–Ω—ñ –Ω–∞ —Ä–æ–ª—ñ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∑–∞—Å—ñ–¥–∞–Ω–Ω—è—Ö:</b>';
var MEETING_ROLES_ASSIGNED_MEMBER_TITLE = '<b>{0} –∑–∞–ø–∏—Å–∞–Ω–∏–π –Ω–∞ —Ä–æ–ª—ñ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∑–∞—Å—ñ–¥–∞–Ω–Ω—è—Ö:</b>';
var MEETING_ROLES_ASSIGNED_DATE_TITLE = '<b>{0}:</b>';

var MEETING_ROLES_CONFIRM = '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —Ä–æ–ª—ñ –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ';
var MEETING_ROLES_CONFIRM_TITLE = '–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å, –±—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–ª–µ–π –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ <b>{0}</b>';

var MEETING_SHOW_ROLES_SELECT_MEMBER = '–û–±–µ—Ä—ñ—Ç—å —á–ª–µ–Ω–∞ –∫–ª—É–±—É:';

/* –ó–ê–ì–û–õ–û–í–ö–ò –ë–ê–ó–ò –î–ê–ù–ù–ò–• */

var MEETING_HEADER_DATE = "–î–∞—Ç–∞";


function processShowMeetingProgram(userData, text) {
    var roles = getMeetingProgramRoles(text);

    var message = format(MEETING_PROGRAM_TITLE, text);;
    for (var i = 0; i < roles.length; i++) {
        var role = roles[i];
        if (!role.speachTitle) {
            message += format(MEETING_PROGRAM_ROLE_INFO, role.name, role.member);
        } else {
            message += format(MEETING_PROGRAM_ROLE_SPEACH_INFO, role.name, role.speachTitle, role.member);
        }
    }
    showMenu(userData.telegramId, message);
    return true;
}

function processSignUpForRole(userData, text) {
    if (userData.statuses[2]) {
        if (userData.statuses[2] == MEETING_SIGN_UP_DATE) {
            if (userData.statuses[3]) {
              if (!userData.statuses[4]) {
                if (tryToUpdateMeetingInfo(userData.statuses[3], text, userData.fullName)) {
                    showMenu(userData.telegramId, format(MEETING_SIGN_UP_SUCCESS, text, userData.statuses[3]));
                } else {

                    showMenu(userData.telegramId, format(MEETING_SIGN_UP_ROLES_BUSY, text, userData.statuses[3]), getMeetingRoles(userData.statuses[3]));
                }
                return true;
              }
            } else {
                showMenu(userData.telegramId, format(MEETING_SIGN_UP_ROLES_AVAILABLE, text), getMeetingRoles(text));
                return true;
            }
        } else if (userData.statuses[2] == MEETING_SIGN_UP_ROLE) {
            if (userData.statuses[3]) {
              if (!userData.statuses[4]) {
                if (tryToUpdateMeetingInfo(text, userData.statuses[3], userData.fullName)) {
                    showMenu(userData.telegramId, format(MEETING_SIGN_UP_SUCCESS, userData.statuses[3], text));
                } else {
                    showMenu(userData.telegramId, format(MEETING_SIGN_UP_DATE_BUSY, userData.statuses[3], text), getAvailableRoleDates(userData.statuses[3]));
                }
                return true;
              }
            } else {
                showMenu(userData.telegramId, format(MEETING_SIGN_UP_DATE_AVAILABLE, text), getAvailableRoleDates(text));
                return true;
            }
        }
    } else {
        if (text == MEETING_SIGN_UP_DATE) {
            showMenu(userData.telegramId, MEETING_SIGN_UP_DATE_REQUEST,
                getNextMeetingDates(SIGN_UP_FOR_NEXT_MEETINGS_AMOUNT));
            return true;
        } else if (text == MEETING_SIGN_UP_ROLE) {
            showMenu(userData.telegramId, MEETING_SIGN_UP_ROLE_REQUEST,
                getMeetingRoles());
            return true;
        }
    }
}

function processAssignRole(userData, text) {
    if (userData.statuses[3]) {
        if (userData.statuses[3] == MEETING_SIGN_UP_DATE) {
            if (userData.statuses[4]) {
                if (userData.statuses[5]) {
                  if (!userData.statuses[6]) {
                    if (tryToUpdateMeetingInfo(userData.statuses[4], text, userData.statuses[5])) {
                        showMenu(userData.telegramId, format(MEETING_ASSIGN_ROLE_SUCCESS, userData.statuses[5], text, userData.statuses[4]));
                    } else {
                        showMenu(userData.telegramId, format(MEETING_ASSIGN_ROLE_BUSY_ROLE, text, userData.statuses[4]), getMeetingRoles(userData.statuses[4]));
                    }
                    return true;
                  }
                } else {
                    showMenu(userData.telegramId, format(MEETING_ASSIGN_ROLE_AVAILABLE_ROLES, userData.statuses[4]), getMeetingRoles(userData.statuses[4]));
                    return true;
                }
            } else {
                showMenu(userData.telegramId, MEETING_ASSIGN_ROLE_SELECT_MEMBER, getAllMembers());
                return true;
            }
        } else if (userData.statuses[3] == MEETING_SIGN_UP_ROLE) {
            if (userData.statuses[4]) {
                if (userData.statuses[5]) {
                  if (!userData.statuses[6]) {
                    if (tryToUpdateMeetingInfo(text, userData.statuses[4], userData.statuses[5])) {
                        showMenu(userData.telegramId, format(MEETING_ASSIGN_ROLE_SUCCESS, userData.statuses[5], userData.statuses[4], text));
                    } else {
                        showMenu(userData.telegramId, format(MEETING_ASSIGN_ROLE_BUSY_DATE, userData.statuses[4], text), getAvailableRoleDates(userData.statuses[4]));
                    }
                    return true;
                  }
                } else {
                    showMenu(userData.telegramId, format(MEETING_ASSIGN_ROLE_AVAILABLE_DATES, userData.statuses[4]), getAvailableRoleDates(userData.statuses[4]));
                    return true;
                }
            } else {
                showMenu(userData.telegramId, MEETING_ASSIGN_ROLE_SELECT_MEMBER, getAllMembers());
                return true;
            }
        }
    } else {
        if (text == MEETING_SIGN_UP_DATE) {
            showMenu(userData.telegramId, MEETING_ASSIGN_ROLE_SELECT_DATE,
                getNextMeetingDates(SIGN_UP_FOR_NEXT_MEETINGS_AMOUNT));
            return true;
        } else if (text == MEETING_SIGN_UP_ROLE) {
            showMenu(userData.telegramId, MEETING_ASSIGN_ROLE_SELECT_ROLE,
                getMeetingRoles());
            return true;
        }
    }
}

function processMeeting(userData, text) {
    if (userData.statuses[1]) {
        if (userData.statuses[1] == MEETING_SIGN_UP_FOR_ROLE) {
            return processSignUpForRole(userData, text);
        } else if (userData.statuses[1] == MEETING_SHOW_PROGRAM) {
            return processShowMeetingProgram(userData, text);
        }
    } else {
        if (text == MEETING_SIGN_UP_FOR_ROLE) {
            showMenu(userData.telegramId, MEETING_SIGN_UP_SELECT_ROLE_OR_DATE, [MEETING_SIGN_UP_DATE, MEETING_SIGN_UP_ROLE]);
            return true;
        } else if (text == MEETING_SHOW_MY_ROLES) {
            showSignedRoles(userData.telegramId, userData.fullName, true);
            return false;
        } else if (text == MEETING_SHOW_PROGRAM) {
            showMenu(userData.telegramId, MEETING_PROGRAM_CHOOSE_DATE, getNextMeetingDates(SIGN_UP_FOR_NEXT_MEETINGS_AMOUNT));
            return true;
        }
    }
}


function processMeetingManagement(userData, text) {
    if (userData.statuses[2]) {
        if (userData.statuses[2] == MEETING_SHOW_ROLES) {
            return showSignedRoles(userData.telegramId, text, false);
        } else if (userData.statuses[2] == MEETING_ASSIGN_ROLE) {
            return processAssignRole(userData, text);
        }
    } else {
        if (text == MEETING_ASSIGN_ROLE) {
            showMenu(userData.telegramId, MEETING_ASSIGN_ROLE_SELECT_ROLE_OR_DATE, [MEETING_SIGN_UP_DATE, MEETING_SIGN_UP_ROLE]);
            return true;
        } else if (text == MEETING_SHOW_ROLES) {
            showMenu(userData.telegramId, MEETING_SHOW_ROLES_SELECT_MEMBER, getAllMembers());
            return true;
        }
    }
}

/* –§–£–ù–ö–¶–Ü–á */

function getLastMeetingDate() {
    var date = new Date();
    var day = date.getDay();
    var prevMonday;
    if (date.getDay() == MEETING_ON_WEEK_DAY) {
        return date;
    }
    return new Date(new Date().setDate(date.getDate() - ((date.getDay() + (7 - MEETING_ON_WEEK_DAY)) % 7)));
}

// day: 0=Sunday, 1=Monday...4=Thursday...
function getNextMeetingDate() {
    var now = new Date();
    var result = new Date(
        now.getFullYear(),
        now.getMonth(),
        now.getDate() + (7 + MEETING_ON_WEEK_DAY - now.getDay()) % 7, 0, 0);

    if (result < now)
        result.setDate(result.getDate() + 7)

    return result
}

/* –°–ü–û–í–Ü–©–ï–ù–ù–Ø */

function sendMeetingNotifications() {
    var date = getNextMeetingDate();
    var roles = getMeetingProgramRoles(date);

    for (var i = 0; i < roles.length; i++) {
        var role = roles[i];
        var roleMember = role.member;
        var roleName = role.name;
        var shortRoleName = roleName;
        var isSpeach = false;

        if (roleMember) {
            if (roleName.indexOf(MEETING_SPEACH) > -1) {
                shortRoleName = MEETING_SPEACH;
                isSpeach = true;
            } else if (roleName.indexOf(MEETING_EVALUATION) > -1) {
                shortRoleName = MEETING_EVALUATION;
            }
            var memberInfo = getMemberInfo(MEMBERS_HEADER_FULLNAME, roleMember);
            showMenu(memberInfo.telegramId, format(MEETING_NOTIFICATION_TITLE, formatDate(date), shortRoleName, memberInfo.fields[MEMBERS_HEADER_CALLNAME]));
            showMenu(memberInfo.telegramId, MEETING_ROLE_INFO[shortRoleName]);

            if (isSpeach) {
                if (!role.speachProject) {
                    var callbackData = MEETING_SPEACH_CHANGE_PROJECT_CALLBACK + '___' + formatDate(date) + '___' + roleName + '___' + roleMember;
                    var callbackId = inseertCallback(callbackData);
                    var keyBoard = [{
                        text: MEETING_SPEACH_CHANGE_PROJECT,
                        callback: callbackId
                    }];

                    sendText(memberInfo.telegramId, MEETING_SPEACH_NO_PROJECT, getMenuInlineKeyBoardMultiline(keyBoard));
                }

                if (!role.speachTitle) {
                    var callbackData = MEETING_SPEACH_CHANGE_TITLE_CALLBACK + '___' + formatDate(date) + '___' + roleName + '___' + roleMember;
                    var callbackId = inseertCallback(callbackData);
                    var keyBoard = [{
                        text: MEETING_SPEACH_CHANGE_TITLE,
                        callback: callbackId
                    }];

                    sendText(memberInfo.telegramId, MEETING_SPEACH_NO_TITLE, getMenuInlineKeyBoardMultiline(keyBoard));
                }
            }
        }
    }
}

/* –†–û–ë–û–¢–ê –ó –ë–ê–ó–û–Æ */

function tryToUpdateMeetingInfo(date, setHeader, setValue) {
    if (setHeader == MEETING_SPEACH || setHeader == MEETING_EVALUATION) {
        for (var i = 1; i <= 4; i++) {
            if (updateMeetingInfo(date, setHeader + " ‚Ññ" + i, setValue, true)) {
                return true;
            }
        }
        return false;
    }

    return updateMeetingInfo(date, setHeader, setValue, true)
}

function updateMeetingInfo(date, setHeader, setValue, updateOnlyIfFree) {
    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_MEETINGS);
    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];

    var dateColumnIndex = headerValues.findIndex(MEETING_HEADER_DATE) + 1;
    var setColumnIndex = headerValues.findIndex(setHeader) + 1;

    if (setColumnIndex == 0) {
        return false;
    }

    var dateValues = sheet.getRange(2, dateColumnIndex, sheet.getLastRow(), 1).getValues();
    var dateRowIndex = -1;

    var oneWeekAgo = new Date();
    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

    for (var i = 0; i < dateValues.length; i++) {
        var date2 = new Date(dateValues[i]);

        if (date2 < oneWeekAgo) {
            continue;
        }

        var date1 = typeof date.getMonth === 'function' ? date : parseDate(date);

        if (date1.getYear() == date2.getYear() &&
            date1.getMonth() == date2.getMonth() &&
            date1.getDate() == date2.getDate()) {
            dateRowIndex = i;
            break;
        }
    }

    if (dateRowIndex > -1) {
        if (!updateOnlyIfFree || !sheet.getRange(dateRowIndex + 2, setColumnIndex).getValue()) {
            sheet.getRange(dateRowIndex + 2, setColumnIndex).setValue(setValue);
            return true;
        } else {
            return false;
        }
    }
}

function getMeetingProgramRoles(date) {
    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_MEETINGS);

    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    var toastmasterColumnIndex = headerValues.findIndex(MEETING_ROLE_TOASTMASTER) + 1;
    var dateColumnIndex = headerValues.findIndex(MEETING_HEADER_DATE) + 1;
    var rolesValues = [];

    var values = sheet.getRange(1, dateColumnIndex, sheet.getLastRow(), sheet.getLastColumn()).getValues();
    var meetingDate = parseDate(date);
    var roles = [];

    for (var i = 0; i < values.length; i++) {
        var row = values[i];

        var parsedDate = parseDate(row[0]);

        if (meetingDate.getYear() == parsedDate.getYear() &&
            meetingDate.getMonth() == parsedDate.getMonth() &&
            meetingDate.getDate() == parsedDate.getDate()) {

            for (var k = 1; k < row.length; k++) {
                var role = {};
                role.name = values[0][k];
                role.member = row[k] ? row[k] : '';

                if (role.name.indexOf(MEETING_SPEACH_PROJECT) > -1 ||
                    role.name.indexOf(MEETING_SPEACH_TITLE) > -1 ||
                    role.name.indexOf(MEETING_WORD_OF_THE_DAY) > -1||
                    role.name.indexOf(MEETING_TOPIC_NAME) > -1) {
                    continue;
                }

                if (role.name.indexOf(MEETING_SPEACH) > -1) {
                    role.speachProject = row[k + 1];
                    role.speachTitle = row[k + 2];
                }

                if (role.name) {
                    roles.push(role);
                }
            }

            break;
        }
    }

    return roles;
}

function getMeetingRoles(date) {
    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_MEETINGS);

    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    var toastmasterColumnIndex = headerValues.findIndex(MEETING_ROLE_TOASTMASTER) + 1;
    var dateColumnIndex = headerValues.findIndex(MEETING_HEADER_DATE) + 1;
    var rolesValues = [];

    headerValues = sheet.getRange(1, toastmasterColumnIndex, 1, sheet.getLastColumn()).getValues()[0];

    // If date is not valid - show all available roles
    if (date) {
        var dateValues = sheet.getRange(2, dateColumnIndex, sheet.getLastRow(), 1).getValues();
        var dateRowIndex = -1;

        for (var i = dateValues.length - 1; i >= 0; i--) {
            var date1 = typeof date.getMonth === 'function' ? date : parseDate(date);
            var date2 = new Date(dateValues[i]);
            if (date1.getYear() == date2.getYear() &&
                date1.getMonth() == date2.getMonth() &&
                date1.getDate() == date2.getDate()) {
                dateRowIndex = i;
                break;
            }
        }

        if (dateRowIndex == -1) {
            throw "Date row wasn't found!";
        }

        rolesValues = sheet.getRange(dateRowIndex + 2, toastmasterColumnIndex, 1, sheet.getLastColumn()).getValues()[0];
    }

    var roles = [];

    for (var i = 0; i < headerValues.length; i++) {
        var role = headerValues[i];

        if (role &&
            role.indexOf(MEETING_SPEACH_PROJECT) == -1 &&
            role.indexOf(MEETING_SPEACH_TITLE) == -1 &&
            role.indexOf(MEETING_TOPIC_NAME) == -1 &&
            role.indexOf(MEETING_WORD_OF_THE_DAY) == -1) {
            if (rolesValues.length == 0 || !rolesValues[i]) {
                var role = role.replace(" ‚Ññ1", "").replace(" ‚Ññ2", "").replace(" ‚Ññ3", "").replace(" ‚Ññ4", "");
                if (roles.indexOf(role) == -1) {
                    roles.push(role);
                }
            }
        }
    }

    return roles;
}

function getAvailableRoleDates(role) {
    getNextMeetingDates(SIGN_UP_FOR_NEXT_MEETINGS_AMOUNT);

    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_MEETINGS);

    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    var toastmasterColumnIndex = headerValues.findIndex(MEETING_ROLE_TOASTMASTER) + 1;
    var dateColumnIndex = headerValues.findIndex(MEETING_HEADER_DATE) + 1;

    var dateValues = sheet.getRange(2, dateColumnIndex, sheet.getLastRow(), 1).getValues();

    var availableDates = [];

    for (var i = 0; i < dateValues.length; i++) {
        var date = typeof dateValues[i].getMonth === 'function' ? dateValues[i] : new Date(dateValues[i]);
        var now = new Date();

        if (date >= now) {
            var availbleRoles = getMeetingRoles(date);
            if (availbleRoles.indexOf(role) > -1) {
                availableDates.push(formatDate(date));
            }
        }
    }
    return availableDates;
}


function getNextMeetingDates(amount) {

    var sheet = SpreadsheetApp.openById(databaseSpreadSheetId).getSheetByName(SHEET_MEETINGS);

    var headerValues = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    var dateColumnIndex = headerValues.findIndex(MEETING_HEADER_DATE) + 1;

    var lastDate = sheet.getRange(sheet.getLastRow(), dateColumnIndex).getValue();

    var meetings = [];

    var nextMeetingDate = getNextMeetingDate();
    meetings.push(formatDate(nextMeetingDate));

    for (var i = 0; i < amount - 1; i++) {
        var date = nextMeetingDate.addDays((i + 1) * 7);
        meetings.push(formatDate(date));

        if (date > lastDate) {
            sheet.insertRowsAfter(sheet.getLastRow(), 1);
            sheet.getRange(sheet.getLastRow() + 1, dateColumnIndex).setValue(formatDate(date));
        }
    }

    return meetings;
}